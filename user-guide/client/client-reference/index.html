<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://github.com/airbusgeo/geocube-client-python/user-guide/client/client-reference/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Basic access - Geocube Client Python</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Basic access";
        var mkdocs_page_input_path = "user-guide/client/client-reference.md";
        var mkdocs_page_url = "/airbusgeo/geocube-client-python/user-guide/client/client-reference/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Geocube Client Python
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../quickstart/">Getting started</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/">Tutorials</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Client</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Basic access</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client">Client</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.add_records_tags">add_records_tags</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.containers">containers</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.create_aoi">create_aoi</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.create_grid">create_grid</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.create_layout">create_layout</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.create_palette">create_palette</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.create_record">create_record</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.create_records">create_records</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.create_variable">create_variable</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.delete_grid">delete_grid</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.delete_layout">delete_layout</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.delete_records">delete_records</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.find_container_layouts">find_container_layouts</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.get_cube">get_cube</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.get_cube_it">get_cube_it</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.get_record">get_record</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.get_records">get_records</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.get_xyz_tile">get_xyz_tile</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.index">index</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.index_dataset">index_dataset</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.layout">layout</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.list_grids">list_grids</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.list_layouts">list_layouts</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.list_records">list_records</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.list_variables">list_variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.load_aoi">load_aoi</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.record">record</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.remove_records_tags">remove_records_tags</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.tile_aoi">tile_aoi</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.variable">variable</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geocube.Client.version">version</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../consolidater-reference/">Consolidater</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../admin-reference/">Admin</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Entities</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../entities/variable-reference/">Variable</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../entities/record-reference/">Records</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../entities/dataset-reference/">Dataset & Container</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../entities/layout-reference/">Layout & Grid</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../entities/job-reference/">Job</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >GetCube</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../getcube/tile-reference/">Tile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../getcube/cubeparams-reference/">CubeParams</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../getcube/cubemetadata-reference/">CubeMetadata</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../grpc/">GRPC Interface</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../about/help/">Getting help</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../about/CONTRIBUTING/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../about/license/">License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../about/release-notes/">Release Notes</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Geocube Client Python</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">User guide</li>
          <li class="breadcrumb-item">Client</li>
      <li class="breadcrumb-item active">Basic access</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="client">Client</h1>
<p>Geocube-client has three level of access:</p>
<ul>
<li><code>Client</code> is for basic access. The <code>Client</code> has <a href="https://fr.wikipedia.org/wiki/CRUD">CRUD</a> access to most entities. It can also index new images.</li>
<li><a href="../consolidater-reference/">Consolidater</a> is for optimization of the database, through consolidation of the datasets. It has CRUD access to <code>entities.job</code>.</li>
<li><a href="../admin-reference/">Admin</a> is for operation that must be done wisely and cautiously.</li>
</ul>


<div class="doc doc-object doc-class">



<a id="geocube.Client"></a>
    <div class="doc doc-contents first">








              <details class="quote">
                <summary>Source code in <code>geocube/client.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Client</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">secure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise the connexion to the Geocube Server</span>

<span class="sd">        Args:</span>
<span class="sd">            uri: of the Geocube Server</span>
<span class="sd">            secure: True to use a TLS Connexion</span>
<span class="sd">            api_key: (optional) API Key if Geocube Server is secured using a bearer authentication</span>
<span class="sd">            verbose: set the default verbose mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">uri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uri</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;geocube.Client: Cannot connect: uri is not defined&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">secure</span><span class="p">:</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ssl_channel_credentials</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">api_key</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">token_credentials</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">access_token_call_credentials</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">credentials</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">composite_channel_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">token_credentials</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">secure_channel</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span> <span class="o">=</span> <span class="n">Stub</span><span class="p">(</span><span class="n">geocube_grpc</span><span class="o">.</span><span class="n">GeocubeStub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channel</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected to Geocube v&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_pid_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">use_downloader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloader</span><span class="p">:</span> <span class="n">Downloader</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span> <span class="o">=</span> <span class="n">downloader</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout_sec</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout_sec</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns the version of the Geocube Server &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">id_</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a variable given an id, a name or an instance id (mutually exclusive)</span>

<span class="sd">        Args:</span>
<span class="sd">            name:</span>
<span class="sd">            id_: internal id of the variable (uuid4)</span>
<span class="sd">            instance_id: internal id of one instance of the variable (uuid4)</span>

<span class="sd">        Returns:</span>
<span class="sd">            either a Variable (first two cases) or a VariableInstance (specialization of the variable)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dformat</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">,</span> <span class="n">bands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="n">resampling_alg</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a single Variable</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the variable</span>
<span class="sd">            dformat: data format of the variable (min and max are the theoretical extrema)</span>
<span class="sd">            bands: Name of the bands</span>
<span class="sd">            unit: of the data (for user information only)</span>
<span class="sd">            description: of the data (for user information only)</span>
<span class="sd">            palette: for rendering in png (TileServer). Must be created using create_palette.</span>
<span class="sd">            resampling_alg: when reprojection is needed (see entities.Resampling)</span>
<span class="sd">            exist_ok: (optional, see warning): if already exists, do not raise an error. !!! WARNING: it does not mean</span>
<span class="sd">                that the variable already stored in the geocube is exactly the same !!!</span>

<span class="sd">        Returns:</span>
<span class="sd">            the variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_variable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_palette</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">colors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new palette from [0, 1] to RGBA, providing a list of index from 0 to 1.</span>
<span class="sd">        The intermediate values are linearly interpolated.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the palette</span>
<span class="sd">            colors: a list of tuple[index, R, G, B, A] mapping index to the corresponding RGBA value</span>
<span class="sd">            replace: if a palette already exists with the same name, replace it else raise an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_palette</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">replace</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all the variables given a pattern</span>

<span class="sd">        Args:</span>
<span class="sd">            name: pattern of the name. * and ? are supported to match all or any character.</span>
<span class="sd">                (?i) can be added at the end to be insensitive to case</span>
<span class="sd">            limit: limit the number of variables returned</span>
<span class="sd">            page: number of the page (starting at 0).</span>

<span class="sd">        Returns:</span>
<span class="sd">            a list of variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_variables</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">],</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new AOI. Raise an error if an AOI with the same coordinates already exists.</span>
<span class="sd">        The id of the AOI can be retrieved from the details of the error.</span>

<span class="sd">        Args:</span>
<span class="sd">            aoi: in geographic coordinates</span>
<span class="sd">            exist_ok: (optional): if already exists, do not raise an error and return the aoi_id</span>

<span class="sd">        Returns:</span>
<span class="sd">            the id of the AOI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_aoi</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new record. A record is uniquely identified with the tuple (name, tags, date)</span>
<span class="sd">        Raise an error if a record with the same Name, Tags and Date already exists.</span>

<span class="sd">        Args:</span>
<span class="sd">            aoi_id: uuid4 of the AOI.</span>
<span class="sd">            name: of the records.</span>
<span class="sd">            tags: user-defined tags associated to the record.</span>
<span class="sd">            date: date of the data referenced by the record.</span>
<span class="sd">            exist_ok: (optional, see warning): if already exists, do not raise an error !!! WARNING: it does not mean</span>
<span class="sd">                that the record in the geocube is the same: its aoi may be different !!!</span>

<span class="sd">        Returns:</span>
<span class="sd">            the ID of the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_records</span><span class="p">([</span><span class="n">aoi_id</span><span class="p">],</span> <span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="p">[</span><span class="n">tags</span><span class="p">],</span> <span class="p">[</span><span class="n">date</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">utils</span><span class="o">.</span><span class="n">GeocubeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_already_exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">exist_ok</span><span class="p">:</span>
                <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_records</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">date</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">aoi_id</span> <span class="o">!=</span> <span class="n">aoi_id</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Record already exists in the Geocube but the aoi_id is different&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                       <span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">dates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a list of records. All inputs must have the same length.</span>
<span class="sd">        (see create_record for the description of the parameters)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_records</span><span class="p">(</span><span class="n">aoi_ids</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Deprecated: use record() instead &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get a record by id &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_records</span><span class="p">([</span><span class="n">_id</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">GeocubeError</span><span class="p">(</span><span class="s2">&quot;get_record&quot;</span><span class="p">,</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;record with id &quot;</span> <span class="o">+</span> <span class="n">_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_records</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">from_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">aoi</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_aoi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List records given filters</span>

<span class="sd">        Args:</span>
<span class="sd">            name: pattern of the name. * and ? are supported to match all or any character.</span>
<span class="sd">                (?i) can be added at the end to be insensitive to case</span>
<span class="sd">            tags: list of mandatory tags. Support the same pattern as name.</span>
<span class="sd">            from_time: filter by date</span>
<span class="sd">            to_time: filter by date</span>
<span class="sd">            aoi: records that intersect the AOI in geographic coordinates</span>
<span class="sd">            limit: the number of records returned (0 to return all records)</span>
<span class="sd">            page: start at 0</span>
<span class="sd">            with_aoi: also returns the AOI of the record. Otherwise, only the ID of the aoi is returned.</span>
<span class="sd">                load_aoi(record) can be called to retrieve the AOI later.</span>

<span class="sd">        Returns:</span>
<span class="sd">            a list of records</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_records</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">with_aoi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the geometry of the AOI of the given record</span>

<span class="sd">        Args:</span>
<span class="sd">            aoi_id: uuid of the AOI or the record. If the record is provided, its geometry will be updated</span>

<span class="sd">        Returns:</span>
<span class="sd">            the geometry of the AOI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_aoi</span><span class="p">(</span><span class="n">aoi_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_records_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add or update tags to a list of records</span>

<span class="sd">        Args:</span>
<span class="sd">            records: List of records to be updated</span>
<span class="sd">            tags: List of new tags or tags to be updated</span>

<span class="sd">        Returns:</span>
<span class="sd">            the number of updated records</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_records_tags</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_records_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">tag_keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Remove tags keys from a list of records</span>

<span class="sd">        Args:</span>
<span class="sd">            records: List of records to be updated</span>
<span class="sd">            tag_keys: List of keys to be deleted</span>

<span class="sd">        Returns:</span>
<span class="sd">            the number of updated records</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_records_tags</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">tag_keys</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">no_fail</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete records iif no dataset are indexed to them.</span>

<span class="sd">        Args:</span>
<span class="sd">            records: List of records to be deleted</span>
<span class="sd">            no_fail: if true, do not fail if some records still have datasets that refer to them, and delete the others</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_records</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">no_fail</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">containers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uris</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get containers and their datasets by uris</span>

<span class="sd">        Args:</span>
<span class="sd">            uris: uri or list of uris</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">(</span><span class="n">uris</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">containers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Index a new container.</span>

<span class="sd">        Args:</span>
<span class="sd">            containers: List of container to index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span><span class="n">containers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">index_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">datetime</span><span class="p">]],</span>
                      <span class="n">instance</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">,</span> <span class="n">dformat</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">,</span> <span class="n">bands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">min_out</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_out</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">managed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Index the given &quot;bands&quot; of the dataset located at &quot;uri&quot;, referenced by a record and an instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            uri: of the file to index</span>
<span class="sd">            record: id of the record describing the data-take or a tuple (name, metadata, datetime)</span>
<span class="sd">                to create the record on the fly</span>
<span class="sd">            instance: describing the data</span>
<span class="sd">            dformat: describing the internal format (see entities.DataFormat.from_user())</span>
<span class="sd">            bands: subset of bands&#39; file (start at 1) that maps to `variable.bands` (by default, all the bands)</span>
<span class="sd">            min_out: (optional, default: instance.dformat.min_value, instance.dformat.dtype) maps dformat.min_value</span>
<span class="sd">            max_out: (optional, default: instance.dformat.max_value, instance.dformat.dtype) maps dformat.max_value</span>
<span class="sd">            exponent: (optional, default: 1) non-linear scaling between dformat.min_max_value to min_max_out.</span>
<span class="sd">            managed: if True, the geocube takes the ownership of the file, removing it if the dataset is removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_dataset</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">min_out</span><span class="p">,</span> <span class="n">max_out</span><span class="p">,</span> <span class="n">exponent</span><span class="p">,</span> <span class="n">managed</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cube_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeMetadata</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cube_metadata</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeParams</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">resampling_alg</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">undefined</span><span class="p">,</span>
                 <span class="n">headers_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">GroupedRecords</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get a cube given a CubeParameters</span>

<span class="sd">        Args:</span>
<span class="sd">            params: CubeParams (see entities.CubeParams)</span>
<span class="sd">            resampling_alg: if defined, overwrite the variable.Resampling used for reprojection.</span>
<span class="sd">            headers_only: Only returns the header of each image (gives an overview of the query)</span>
<span class="sd">            compression: define a level of compression to speed up the transfer.</span>
<span class="sd">                (0: no compression, 1 fastest to 9 best, -2: huffman-only)</span>
<span class="sd">                The data is compressed by the server and decompressed by the Client.</span>
<span class="sd">                Compression=0 or -2 is advised if the bandwidth is not limited</span>
<span class="sd">            verbose: display information during the transfer (if None, use the default verbose mode)</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of images (np.ndarray) and the list of corresponding records</span>
<span class="sd">                (several records can be returned for each image when they are grouped together,</span>
<span class="sd">                by date or something else. See entities.Record.group_by)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cube_it</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="o">=</span><span class="n">resampling_alg</span><span class="p">,</span>
                                 <span class="n">headers_only</span><span class="o">=</span><span class="n">headers_only</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">images</span><span class="p">,</span> <span class="n">grouped_records</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">verbose</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GetCube returns </span><span class="si">{}</span><span class="s2"> images from </span><span class="si">{}</span><span class="s2"> datasets&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">cube</span><span class="o">.</span><span class="n">nb_datasets</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">cube</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="n">cubeiterator</span><span class="o">.</span><span class="n">NOT_FOUND_ERROR</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">min_date</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">min_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H:%M:%S&quot;</span><span class="p">)</span>
                <span class="n">max_date</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">max_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H:%M:%S&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image </span><span class="si">{}</span><span class="s2"> received (</span><span class="si">{}{}</span><span class="s2">kb) RecordTime:</span><span class="si">{}</span><span class="s2"> RecordName:</span><span class="si">{}</span><span class="s2"> Shape:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">cube</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span> <span class="k">if</span> <span class="n">headers_only</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">bytes</span> <span class="o">//</span> <span class="mi">1024</span><span class="p">,</span>
                    <span class="n">min_date</span> <span class="k">if</span> <span class="n">min_date</span> <span class="o">==</span> <span class="n">max_date</span> <span class="k">else</span> <span class="n">min_date</span> <span class="o">+</span> <span class="s2">&quot; to &quot;</span> <span class="o">+</span> <span class="n">max_date</span><span class="p">,</span>
                    <span class="n">metadata</span><span class="o">.</span><span class="n">grouped_records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="n">grouped_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">grouped_records</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">grouped_records</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cube_it</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeParams</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                    <span class="n">resampling_alg</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">undefined</span><span class="p">,</span>
                    <span class="n">headers_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="n">file_format</span><span class="o">=</span><span class="n">FileFormatRaw</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeIterator</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns a cube iterator over the requested images</span>

<span class="sd">        Args:</span>
<span class="sd">            params: CubeParams (see entities.CubeParams)</span>

<span class="sd">            resampling_alg: if defined, overwrite the variable.Resampling used for reprojection.</span>
<span class="sd">            headers_only : returns only the header of the dataset (use this option to control the output of get_cube)</span>
<span class="sd">            compression : define a level of compression to speed up the transfer</span>
<span class="sd">                (0: no compression, 1 fastest to 9 best, -2: huffman-only)</span>
<span class="sd">                The data is compressed by the server and decompressed by the Client.</span>
<span class="sd">                Compression=0 or -2 is advised if the bandwidth is not limited</span>
<span class="sd">            file_format : (optional) currently supported geocube.FileFormatRaw &amp; geocube.FileFormatGTiff</span>
<span class="sd">            file_pattern : (optional) iif file_format != Raw, pattern of the file name.</span>
<span class="sd">                {#} will be replaced by the number of image, {date} and {id} by the value of the record</span>

<span class="sd">        Returns:</span>
<span class="sd">            an iterator yielding an image, its associated records, an error (or None) and the size of the image</span>
<span class="sd">        &gt;&gt;&gt; client = Client(&#39;127.0.0.1:8080&#39;, False)</span>
<span class="sd">        &gt;&gt;&gt; cube_params = entities.CubeParams.from_records(&quot;+proj=utm +zone=31&quot;,</span>
<span class="sd">        ...     entities.geo_transform(366162, 4833123, 30), (512, 512),</span>
<span class="sd">        ...     client.variable(name=&quot;test/rgb&quot;).instance(&quot;master&quot;), records=client.list_records(&#39;france&#39;))</span>
<span class="sd">        affine.Affine.translation(366162, 4833123)*affine.Affine.scale(30, -30))</span>
<span class="sd">        &gt;&gt;&gt; cube_it = client.get_cube_it(cube_params)</span>
<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; for image, _, _, err in cube_it:</span>
<span class="sd">        ...     if err != cubeiterator.NOT_FOUND_ERROR:</span>
<span class="sd">        ...         raise ValueError(err)</span>
<span class="sd">        ...     if not err:</span>
<span class="sd">        ...         plt.figure(cube_it.index+1)</span>
<span class="sd">        ...         plt.imshow(image)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cube_it</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="o">=</span><span class="n">resampling_alg</span><span class="p">,</span> <span class="n">headers_only</span><span class="o">=</span><span class="n">headers_only</span><span class="p">,</span>
                                 <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span> <span class="n">file_pattern</span><span class="o">=</span><span class="n">file_pattern</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tile_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">],</span>
                 <span class="n">layout_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">layout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">resolution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Tile</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tile an AOI</span>

<span class="sd">        Args:</span>
<span class="sd">            aoi: AOI to be tiled in **geographic coordinates**</span>
<span class="sd">            crs: CRS of the tile (not the AOI)</span>
<span class="sd">            resolution: resolution of the tile</span>
<span class="sd">            shape: shape of each tile</span>
<span class="sd">            layout_name: use a defined layout.</span>
<span class="sd">            layout: use a customer defined layout</span>

<span class="sd">        Returns:</span>
<span class="sd">            a list of Tiles covering the AOI in the given CRS at the given resolution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_aoi</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">layout_name</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_xyz_tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">],</span>
                     <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a PNG file covering the (X,Y,Z) web-mercator tile, using the palette of the variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            instance: instance of the variable</span>
<span class="sd">            records: list of records</span>
<span class="sd">            x: coordinate of the web-mercator XYZ tile</span>
<span class="sd">            y: coordinate of the web-mercator XYZ tile</span>
<span class="sd">            z: coordinate of the web-mercator XYZ tile</span>
<span class="sd">            file: output PNG file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xyz_tile</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">records</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a layout in the Geocube</span>
<span class="sd">        exist_ok: (optional, see warning): if already exists, do not raise an error. !!! WARNING: it does not mean that</span>
<span class="sd">        the layout already stored in the geocube is exactly the same !!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get layout by name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_layouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_like</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List available layouts by name</span>
<span class="sd">        name_like: pattern of the name. * and ? are supported to match all or any character.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_layouts</span><span class="p">(</span><span class="n">name_like</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_container_layouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">],</span>
                               <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">from_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">aoi</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find layouts of the containers covering an area or a list of records for a given instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_container_layouts</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">records</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="p">,</span> <span class="n">aoi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Delete a layout from the Geocube &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_layout</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a grid in the Geocube&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_like</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Grid</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List grids by name</span>
<span class="sd">        name_like: pattern of the name. * and ? are supported to match all or any character.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_grids</span><span class="p">(</span><span class="n">name_like</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Delete a grid by its name &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_grid</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">Version</span><span class="p">(</span><span class="n">version_pb2</span><span class="o">.</span><span class="n">GetVersionRequest</span><span class="p">())</span><span class="o">.</span><span class="n">Version</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">id_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">id_</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">variables_pb2</span><span class="o">.</span><span class="n">GetVariableRequest</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">variables_pb2</span><span class="o">.</span><span class="n">GetVariableRequest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">instance_id</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">variables_pb2</span><span class="o">.</span><span class="n">GetVariableRequest</span><span class="p">(</span><span class="n">instance_id</span><span class="o">=</span><span class="n">instance_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;One of id_, name or instance_id must be defined&quot;</span><span class="p">)</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetVariable</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">instance_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dformat</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">,</span> <span class="n">bands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">palette</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">variables_pb2</span><span class="o">.</span><span class="n">CreateVariableRequest</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">variables_pb2</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">dformat</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">DataFormat</span><span class="o">.</span><span class="n">from_user</span><span class="p">(</span><span class="n">dformat</span><span class="p">)</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
            <span class="n">resampling_alg</span><span class="o">=</span><span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateVariable</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">GeocubeError</span><span class="o">.</span><span class="n">from_rpc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_already_exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">exist_ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_palette</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">colors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">variables_pb2</span><span class="o">.</span><span class="n">colorPoint</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">a</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">variables_pb2</span><span class="o">.</span><span class="n">CreatePaletteRequest</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="n">variables_pb2</span><span class="o">.</span><span class="n">Palette</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">),</span>
                                                 <span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreatePalette</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_list_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="p">]:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">variables_pb2</span><span class="o">.</span><span class="n">ListVariablesRequest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span> <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ListVariables</span><span class="p">(</span><span class="n">req</span><span class="p">)]</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">],</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">records_pb2</span><span class="o">.</span><span class="n">CreateAOIRequest</span><span class="p">(</span><span class="n">aoi</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">aoi_to_pb</span><span class="p">(</span><span class="n">aoi</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateAOI</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">id</span>
        <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">GeocubeError</span><span class="o">.</span><span class="n">from_rpc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_already_exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">exist_ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">details</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="k">raise</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                        <span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">dates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aoi_ids</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All fields must have the same length&quot;</span><span class="p">)</span>

        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
            <span class="n">record</span> <span class="o">=</span> <span class="n">records_pb2</span><span class="o">.</span><span class="n">NewRecord</span><span class="p">(</span><span class="n">aoi_id</span><span class="o">=</span><span class="n">aoi_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">record</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">FromDatetime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">records_pb2</span><span class="o">.</span><span class="n">CreateRecordsRequest</span><span class="p">(</span><span class="n">records</span><span class="o">=</span><span class="n">records</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateRecords</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">ids</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">records_pb2</span><span class="o">.</span><span class="n">GetRecordsRequest</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetRecords</span><span class="p">(</span><span class="n">req</span><span class="p">)]</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_list_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">from_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">to_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
                      <span class="n">aoi</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">with_aoi</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">records_pb2</span><span class="o">.</span><span class="n">ListRecordsRequest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
                                             <span class="n">aoi</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">aoi_to_pb</span><span class="p">(</span><span class="n">aoi</span><span class="p">),</span>
                                             <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">with_aoi</span><span class="o">=</span><span class="n">with_aoi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">from_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">from_time</span><span class="o">.</span><span class="n">FromDatetime</span><span class="p">(</span><span class="n">from_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">to_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">to_time</span><span class="o">.</span><span class="n">FromDatetime</span><span class="p">(</span><span class="n">to_time</span><span class="p">)</span>

        <span class="n">records</span> <span class="o">=</span> <span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ListRecords</span><span class="p">(</span><span class="n">req</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Maximum number of records reached. Call list_records(..., page=) or &quot;</span>
                          <span class="s2">&quot;list_records(..., limit=) to get more records.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">records</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_load_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">:</span>
        <span class="n">record</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aoi_id</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">):</span>
            <span class="n">record</span> <span class="o">=</span> <span class="n">aoi_id</span>
            <span class="n">aoi_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">aoi_id</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetAOI</span><span class="p">(</span><span class="n">records_pb2</span><span class="o">.</span><span class="n">GetAOIRequest</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">aoi_id</span><span class="p">))</span>
        <span class="n">aoi</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">aoi_from_pb</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">aoi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">aoi</span> <span class="o">=</span> <span class="n">aoi</span>
        <span class="k">return</span> <span class="n">aoi</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_add_records_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">records_pb2</span><span class="o">.</span><span class="n">AddRecordsTagsRequest</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">get_ids</span><span class="p">(</span><span class="n">records</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">AddRecordsTags</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">nb</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_records_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">tag_keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">records_pb2</span><span class="o">.</span><span class="n">RemoveRecordsTagsRequest</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">get_ids</span><span class="p">(</span><span class="n">records</span><span class="p">),</span> <span class="n">tagsKey</span><span class="o">=</span><span class="n">tag_keys</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">RemoveRecordsTags</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">nb</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_delete_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">no_fail</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">records_pb2</span><span class="o">.</span><span class="n">DeleteRecordsRequest</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">get_ids</span><span class="p">(</span><span class="n">records</span><span class="p">),</span> <span class="n">no_fail</span><span class="o">=</span><span class="n">no_fail</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteRecords</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_containers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uris</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">]]:</span>
        <span class="n">singleton</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uris</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">singleton</span><span class="p">:</span>
            <span class="n">uris</span> <span class="o">=</span> <span class="p">[</span><span class="n">uris</span><span class="p">]</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">operations_pb2</span><span class="o">.</span><span class="n">GetContainersRequest</span><span class="p">(</span><span class="n">uris</span><span class="o">=</span><span class="n">uris</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetContainers</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">containers</span> <span class="o">=</span> <span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="n">pb_container</span><span class="p">)</span> <span class="k">for</span> <span class="n">pb_container</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">containers</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">containers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">singleton</span> <span class="k">else</span> <span class="n">containers</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">containers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">]):</span>
        <span class="n">pb_containers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">containers</span><span class="p">:</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataset</span><span class="o">.</span><span class="n">to_pb</span><span class="p">()</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">datasets</span><span class="p">]</span>

            <span class="n">pb_containers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operations_pb2</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
                <span class="n">uri</span><span class="o">=</span><span class="n">container</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span>
                <span class="n">managed</span><span class="o">=</span><span class="n">container</span><span class="o">.</span><span class="n">managed</span><span class="p">,</span>
                <span class="n">datasets</span><span class="o">=</span><span class="n">datasets</span>
            <span class="p">))</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pb_containers</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">operations_pb2</span><span class="o">.</span><span class="n">IndexDatasetsRequest</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">IndexDatasets</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_index_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">datetime</span><span class="p">]],</span>
                       <span class="n">instance</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">,</span> <span class="n">dformat</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">,</span> <span class="n">bands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                       <span class="n">min_out</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_out</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">managed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">ds_dtype</span> <span class="o">=</span> <span class="s2">&quot;u1&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dformat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
                    <span class="n">tile</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Tile</span><span class="o">.</span><span class="n">from_geotransform</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">ds_dtype</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;if &quot;record&quot; is a tuple or &quot;bands&quot; or &quot;dformat&quot; is not defined, geocube-client tries&#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39; to deduce some information reading the file </span><span class="si">{</span><span class="n">uri</span><span class="si">}</span><span class="s1">, but it encountered&#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39; the following error :</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">aoi_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_aoi</span><span class="p">(</span><span class="n">tile</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">r_name</span><span class="p">,</span> <span class="n">r_tags</span><span class="p">,</span> <span class="n">r_date</span> <span class="o">=</span> <span class="n">record</span>
            <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_record</span><span class="p">(</span><span class="n">aoi_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">r_name</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">r_tags</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">r_date</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dformat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dformat</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">DataFormat</span><span class="o">.</span><span class="n">from_user</span><span class="p">(</span><span class="n">ds_dtype</span><span class="p">)</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span>
                                 <span class="n">managed</span><span class="o">=</span><span class="n">managed</span><span class="p">,</span>
                                 <span class="n">datasets</span><span class="o">=</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
                                                            <span class="n">dformat</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">DataFormat</span><span class="o">.</span><span class="n">from_user</span><span class="p">(</span><span class="n">dformat</span><span class="p">),</span>
                                                            <span class="n">min_out</span><span class="o">=</span><span class="n">min_out</span><span class="p">,</span> <span class="n">max_out</span><span class="o">=</span><span class="n">max_out</span><span class="p">,</span> <span class="n">exponent</span><span class="o">=</span><span class="n">exponent</span><span class="p">)])]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_cube_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeMetadata</span><span class="p">:</span>
        <span class="n">cube_it</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cube_it</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">headers_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cube_it</span><span class="o">.</span><span class="n">metadata</span><span class="p">()</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_cube_it</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeParams</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                     <span class="n">resampling_alg</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">undefined</span><span class="p">,</span>
                     <span class="n">headers_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="n">file_format</span> <span class="o">=</span> <span class="n">FileFormatRaw</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeIterator</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">headers_only</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cube_it</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">headers_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resampling_alg</span> <span class="o">!=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">undefined</span><span class="p">:</span>
                <span class="n">metadata</span><span class="o">.</span><span class="n">resampling_alg</span> <span class="o">=</span> <span class="n">resampling_alg</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">get_cube_it</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span> <span class="n">file_pattern</span><span class="o">=</span><span class="n">file_pattern</span><span class="p">,</span>
                                               <span class="n">predownload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">downloader</span><span class="o">.</span><span class="n">always_predownload</span><span class="p">)</span>

        <span class="n">common</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;instances_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">instance</span><span class="p">],</span>
            <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
            <span class="s2">&quot;pix_to_crs&quot;</span><span class="p">:</span> <span class="n">layouts_pb2</span><span class="o">.</span><span class="n">GeoTransform</span><span class="p">(</span>
                <span class="n">a</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
                <span class="n">d</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">e</span><span class="p">),</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">layouts_pb2</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s2">&quot;compression_level&quot;</span><span class="p">:</span> <span class="n">compression</span><span class="p">,</span>
            <span class="s2">&quot;headers_only&quot;</span><span class="p">:</span> <span class="n">headers_only</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="n">file_format</span><span class="p">,</span>
            <span class="s2">&quot;resampling_alg&quot;</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">records</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">catalog_pb2</span><span class="o">.</span><span class="n">GetCubeRequest</span><span class="p">(</span><span class="o">**</span><span class="n">common</span><span class="p">,</span> <span class="n">grouped_records</span><span class="o">=</span><span class="n">records_pb2</span><span class="o">.</span><span class="n">GroupedRecordIdsList</span><span class="p">(</span>
                <span class="n">records</span><span class="o">=</span><span class="p">[</span><span class="n">records_pb2</span><span class="o">.</span><span class="n">GroupedRecordIds</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span> <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">records</span><span class="p">]</span>
            <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">from_time_pb</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">pb_null_timestamp</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">from_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">from_time_pb</span><span class="o">.</span><span class="n">FromDatetime</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">from_time</span><span class="p">)</span>
            <span class="n">to_time_pb</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">pb_null_timestamp</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">to_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">to_time_pb</span><span class="o">.</span><span class="n">FromDatetime</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">to_time</span><span class="p">)</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">catalog_pb2</span><span class="o">.</span><span class="n">GetCubeRequest</span><span class="p">(</span><span class="o">**</span><span class="n">common</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">records_pb2</span><span class="o">.</span><span class="n">RecordFilters</span><span class="p">(</span>
                <span class="n">tags</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">from_time_pb</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time_pb</span>
            <span class="p">))</span>
        <span class="k">return</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeIterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetCube</span><span class="p">(</span><span class="n">req</span><span class="p">),</span> <span class="n">file_format</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">)</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_tile_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">],</span>
                  <span class="n">layout_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                  <span class="n">layout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">],</span>
                  <span class="n">resolution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
                  <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Tile</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; TODO: use Grid or GridName &quot;&quot;&quot;</span>
        <span class="n">aoi</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">aoi_to_pb</span><span class="p">(</span><span class="n">aoi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layout_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">layouts_pb2</span><span class="o">.</span><span class="n">TileAOIRequest</span><span class="p">(</span><span class="n">aoi</span><span class="o">=</span><span class="n">aoi</span><span class="p">,</span> <span class="n">layout_name</span><span class="o">=</span><span class="n">layout_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">layout</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="o">.</span><span class="n">regular</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">layouts_pb2</span><span class="o">.</span><span class="n">TileAOIRequest</span><span class="p">(</span><span class="n">aoi</span><span class="o">=</span><span class="n">aoi</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="o">.</span><span class="n">to_pb</span><span class="p">())</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Tile</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span> <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">TileAOI</span><span class="p">(</span><span class="n">req</span><span class="p">)</span> <span class="k">for</span> <span class="n">tile</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">tiles</span><span class="p">]</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_xyz_tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">],</span>
                      <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">catalog_pb2</span><span class="o">.</span><span class="n">GetTileRequest</span><span class="p">(</span>
            <span class="n">records</span><span class="o">=</span><span class="n">records_pb2</span><span class="o">.</span><span class="n">GroupedRecordIds</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">get_ids</span><span class="p">(</span><span class="n">records</span><span class="p">)),</span>
            <span class="n">instance_id</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">get_id</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetXYZTile</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateLayout</span><span class="p">(</span><span class="n">layouts_pb2</span><span class="o">.</span><span class="n">CreateLayoutRequest</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="o">.</span><span class="n">to_pb</span><span class="p">()))</span>
        <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">GeocubeError</span><span class="o">.</span><span class="n">from_rpc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">is_already_exists</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exist_ok</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ListLayouts</span><span class="p">(</span><span class="n">layouts_pb2</span><span class="o">.</span><span class="n">ListLayoutsRequest</span><span class="p">(</span><span class="n">name_like</span><span class="o">=</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">layouts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">GeocubeError</span><span class="p">(</span><span class="s2">&quot;layout&quot;</span><span class="p">,</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">ALREADY_EXISTS</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;with name: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">layouts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_list_layouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_like</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">]:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ListLayouts</span><span class="p">(</span><span class="n">layouts_pb2</span><span class="o">.</span><span class="n">ListLayoutsRequest</span><span class="p">(</span><span class="n">name_like</span><span class="o">=</span><span class="n">name_like</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span> <span class="k">for</span> <span class="n">layout</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">layouts</span><span class="p">]</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_find_container_layouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">],</span>
                                <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span>
                                <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                                <span class="n">from_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">to_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
                                <span class="n">aoi</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">records</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">layouts_pb2</span><span class="o">.</span><span class="n">FindContainerLayoutsRequest</span><span class="p">(</span>
                <span class="n">instance_id</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">get_id</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span>
                <span class="n">records</span><span class="o">=</span><span class="n">records_pb2</span><span class="o">.</span><span class="n">RecordIdList</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">get_ids</span><span class="p">(</span><span class="n">records</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">from_time_pb</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">pb_null_timestamp</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">from_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">from_time_pb</span><span class="o">.</span><span class="n">FromDatetime</span><span class="p">(</span><span class="n">from_time</span><span class="p">)</span>
            <span class="n">to_time_pb</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">pb_null_timestamp</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">to_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">to_time_pb</span><span class="o">.</span><span class="n">FromDatetime</span><span class="p">(</span><span class="n">to_time</span><span class="p">)</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">catalog_pb2</span><span class="o">.</span><span class="n">FindContainerLayoutsRequest</span><span class="p">(</span>
                <span class="n">instance_id</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">get_id</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span>
                <span class="n">filters</span><span class="o">=</span><span class="n">records_pb2</span><span class="o">.</span><span class="n">RecordFiltersWithAOI</span><span class="p">(</span><span class="n">aoi</span><span class="o">=</span><span class="n">aoi</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
                                                         <span class="n">from_time</span><span class="o">=</span><span class="n">from_time_pb</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">to_time_pb</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">resp</span><span class="o">.</span><span class="n">layout_name</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">container_uris</span> <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">FindContainerLayouts</span><span class="p">(</span><span class="n">req</span><span class="p">)}</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_delete_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteLayout</span><span class="p">(</span><span class="n">layouts_pb2</span><span class="o">.</span><span class="n">DeleteLayoutRequest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">))</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">max_cells</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cells</span><span class="p">),</span> <span class="mi">10000000</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">req</span> <span class="o">=</span> <span class="p">[</span><span class="n">layouts_pb2</span><span class="o">.</span><span class="n">CreateGridRequest</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(</span><span class="n">max_cells</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">max_cells</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
                       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">max_cells</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateGrid</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">req</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">GeocubeError</span><span class="o">.</span><span class="n">from_rpc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">codename</span> <span class="o">!=</span> <span class="s2">&quot;RESOURCE_EXHAUSTED&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">{volume:d}</span><span class="s2"> vs. </span><span class="si">{max:d}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">details</span><span class="p">)</span>
                <span class="n">max_cells</span> <span class="o">//=</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">//</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_list_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_like</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Grid</span><span class="p">]:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ListGrids</span><span class="p">(</span><span class="n">layouts_pb2</span><span class="o">.</span><span class="n">ListGridsRequest</span><span class="p">(</span><span class="n">name_like</span><span class="o">=</span><span class="n">name_like</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="k">for</span> <span class="n">grid</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">grids</span><span class="p">]</span>

    <span class="nd">@utils</span><span class="o">.</span><span class="n">catch_rpc_error</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_delete_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteGrid</span><span class="p">(</span><span class="n">layouts_pb2</span><span class="o">.</span><span class="n">DeleteGridRequest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="geocube.Client.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">secure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise the connexion to the Geocube Server</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>uri</code></b>
                  (<code><span title="str">str</span></code>)
              
              <div class="doc-md-description">
                <p>of the Geocube Server</p>
              </div>
            </li>
            <li>
              <b><code>secure</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>True to use a TLS Connexion</p>
              </div>
            </li>
            <li>
              <b><code>api_key</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;&#39;</code>
)
              
              <div class="doc-md-description">
                <p>(optional) API Key if Geocube Server is secured using a bearer authentication</p>
              </div>
            </li>
            <li>
              <b><code>verbose</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>True</code>
)
              
              <div class="doc-md-description">
                <p>set the default verbose mode</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">secure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialise the connexion to the Geocube Server</span>

<span class="sd">    Args:</span>
<span class="sd">        uri: of the Geocube Server</span>
<span class="sd">        secure: True to use a TLS Connexion</span>
<span class="sd">        api_key: (optional) API Key if Geocube Server is secured using a bearer authentication</span>
<span class="sd">        verbose: set the default verbose mode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">uri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uri</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;geocube.Client: Cannot connect: uri is not defined&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">secure</span><span class="p">:</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ssl_channel_credentials</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">api_key</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">token_credentials</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">access_token_call_credentials</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">composite_channel_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">token_credentials</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">secure_channel</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stub</span> <span class="o">=</span> <span class="n">Stub</span><span class="p">(</span><span class="n">geocube_grpc</span><span class="o">.</span><span class="n">GeocubeStub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channel</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected to Geocube v&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">downloader</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.add_records_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_records_tags</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add or update tags to a list of records</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>records</code></b>
                  (<code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="geocube.entities.Record" href="../../entities/record-reference/#geocube.entities.Record">Record</a>]]</code>)
              
              <div class="doc-md-description">
                <p>List of records to be updated</p>
              </div>
            </li>
            <li>
              <b><code>tags</code></b>
                  (<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>)
              
              <div class="doc-md-description">
                <p>List of new tags or tags to be updated</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="int">int</span></code>
              
              <div class="doc-md-description">
                <p>the number of updated records</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_records_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add or update tags to a list of records</span>

<span class="sd">    Args:</span>
<span class="sd">        records: List of records to be updated</span>
<span class="sd">        tags: List of new tags or tags to be updated</span>

<span class="sd">    Returns:</span>
<span class="sd">        the number of updated records</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_records_tags</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.containers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">containers</span><span class="p">(</span><span class="n">uris</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get containers and their datasets by uris</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>uris</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="str">str</span>]]</code>)
              
              <div class="doc-md-description">
                <p>uri or list of uris</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">containers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uris</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get containers and their datasets by uris</span>

<span class="sd">    Args:</span>
<span class="sd">        uris: uri or list of uris</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">(</span><span class="n">uris</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.create_aoi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_aoi</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a new AOI. Raise an error if an AOI with the same coordinates already exists.
The id of the AOI can be retrieved from the details of the error.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>aoi</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="shapely.geometry.Polygon">Polygon</span>, <span title="shapely.geometry.MultiPolygon">MultiPolygon</span>]</code>)
              
              <div class="doc-md-description">
                <p>in geographic coordinates</p>
              </div>
            </li>
            <li>
              <b><code>exist_ok</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>(optional): if already exists, do not raise an error and return the aoi_id</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="str">str</span></code>
              
              <div class="doc-md-description">
                <p>the id of the AOI</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">],</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new AOI. Raise an error if an AOI with the same coordinates already exists.</span>
<span class="sd">    The id of the AOI can be retrieved from the details of the error.</span>

<span class="sd">    Args:</span>
<span class="sd">        aoi: in geographic coordinates</span>
<span class="sd">        exist_ok: (optional): if already exists, do not raise an error and return the aoi_id</span>

<span class="sd">    Returns:</span>
<span class="sd">        the id of the AOI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_aoi</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.create_grid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a grid in the Geocube</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a grid in the Geocube&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.create_layout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a layout in the Geocube
exist_ok: (optional, see warning): if already exists, do not raise an error. !!! WARNING: it does not mean that
the layout already stored in the geocube is exactly the same !!!</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a layout in the Geocube</span>
<span class="sd">    exist_ok: (optional, see warning): if already exists, do not raise an error. !!! WARNING: it does not mean that</span>
<span class="sd">    the layout already stored in the geocube is exactly the same !!!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.create_palette" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_palette</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a new palette from [0, 1] to RGBA, providing a list of index from 0 to 1.
The intermediate values are linearly interpolated.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>name</code></b>
                  (<code><span title="str">str</span></code>)
              
              <div class="doc-md-description">
                <p>Name of the palette</p>
              </div>
            </li>
            <li>
              <b><code>colors</code></b>
                  (<code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="int">int</span>, <span title="int">int</span>, <span title="int">int</span>, <span title="int">int</span>]]</code>)
              
              <div class="doc-md-description">
                <p>a list of tuple[index, R, G, B, A] mapping index to the corresponding RGBA value</p>
              </div>
            </li>
            <li>
              <b><code>replace</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>if a palette already exists with the same name, replace it else raise an error.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_palette</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">colors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new palette from [0, 1] to RGBA, providing a list of index from 0 to 1.</span>
<span class="sd">    The intermediate values are linearly interpolated.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the palette</span>
<span class="sd">        colors: a list of tuple[index, R, G, B, A] mapping index to the corresponding RGBA value</span>
<span class="sd">        replace: if a palette already exists with the same name, replace it else raise an error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_palette</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">replace</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.create_record" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_record</span><span class="p">(</span><span class="n">aoi_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a new record. A record is uniquely identified with the tuple (name, tags, date)
Raise an error if a record with the same Name, Tags and Date already exists.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>aoi_id</code></b>
                  (<code><span title="str">str</span></code>)
              
              <div class="doc-md-description">
                <p>uuid4 of the AOI.</p>
              </div>
            </li>
            <li>
              <b><code>name</code></b>
                  (<code><span title="str">str</span></code>)
              
              <div class="doc-md-description">
                <p>of the records.</p>
              </div>
            </li>
            <li>
              <b><code>tags</code></b>
                  (<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>)
              
              <div class="doc-md-description">
                <p>user-defined tags associated to the record.</p>
              </div>
            </li>
            <li>
              <b><code>date</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              
              <div class="doc-md-description">
                <p>date of the data referenced by the record.</p>
              </div>
            </li>
            <li>
              <b><code>exist_ok</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>(optional, see warning): if already exists, do not raise an error !!! WARNING: it does not mean
that the record in the geocube is the same: its aoi may be different !!!</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="str">str</span></code>
              
              <div class="doc-md-description">
                <p>the ID of the record</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
        <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new record. A record is uniquely identified with the tuple (name, tags, date)</span>
<span class="sd">    Raise an error if a record with the same Name, Tags and Date already exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        aoi_id: uuid4 of the AOI.</span>
<span class="sd">        name: of the records.</span>
<span class="sd">        tags: user-defined tags associated to the record.</span>
<span class="sd">        date: date of the data referenced by the record.</span>
<span class="sd">        exist_ok: (optional, see warning): if already exists, do not raise an error !!! WARNING: it does not mean</span>
<span class="sd">            that the record in the geocube is the same: its aoi may be different !!!</span>

<span class="sd">    Returns:</span>
<span class="sd">        the ID of the record</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_records</span><span class="p">([</span><span class="n">aoi_id</span><span class="p">],</span> <span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="p">[</span><span class="n">tags</span><span class="p">],</span> <span class="p">[</span><span class="n">date</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="n">utils</span><span class="o">.</span><span class="n">GeocubeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_already_exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">exist_ok</span><span class="p">:</span>
            <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_records</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="n">date</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">aoi_id</span> <span class="o">!=</span> <span class="n">aoi_id</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Record already exists in the Geocube but the aoi_id is different&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.create_records" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_records</span><span class="p">(</span><span class="n">aoi_ids</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a list of records. All inputs must have the same length.
(see create_record for the description of the parameters)</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                   <span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">dates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a list of records. All inputs must have the same length.</span>
<span class="sd">    (see create_record for the description of the parameters)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_records</span><span class="p">(</span><span class="n">aoi_ids</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.create_variable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_variable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a single Variable</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>name</code></b>
                  (<code><span title="str">str</span></code>)
              
              <div class="doc-md-description">
                <p>Name of the variable</p>
              </div>
            </li>
            <li>
              <b><code>dformat</code></b>
                  (<code><span title="geocube.entities.DataFormat">DataFormat</span></code>)
              
              <div class="doc-md-description">
                <p>data format of the variable (min and max are the theoretical extrema)</p>
              </div>
            </li>
            <li>
              <b><code>bands</code></b>
                  (<code><span title="typing.List">List</span>[<span title="str">str</span>]</code>)
              
              <div class="doc-md-description">
                <p>Name of the bands</p>
              </div>
            </li>
            <li>
              <b><code>unit</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;&#39;</code>
)
              
              <div class="doc-md-description">
                <p>of the data (for user information only)</p>
              </div>
            </li>
            <li>
              <b><code>description</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;&#39;</code>
)
              
              <div class="doc-md-description">
                <p>of the data (for user information only)</p>
              </div>
            </li>
            <li>
              <b><code>palette</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;&#39;</code>
)
              
              <div class="doc-md-description">
                <p>for rendering in png (TileServer). Must be created using create_palette.</p>
              </div>
            </li>
            <li>
              <b><code>resampling_alg</code></b>
                  (<code><span title="geocube.entities.Resampling">Resampling</span></code>, default:
                      <code><span title="geocube.entities.Resampling.bilinear">bilinear</span></code>
)
              
              <div class="doc-md-description">
                <p>when reprojection is needed (see entities.Resampling)</p>
              </div>
            </li>
            <li>
              <b><code>exist_ok</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>(optional, see warning): if already exists, do not raise an error. !!! WARNING: it does not mean
that the variable already stored in the geocube is exactly the same !!!</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="geocube.entities.Variable" href="../../entities/variable-reference/#geocube.entities.Variable">Variable</a></code>
              
              <div class="doc-md-description">
                <p>the variable</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dformat</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">,</span> <span class="n">bands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">resampling_alg</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
        <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a single Variable</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the variable</span>
<span class="sd">        dformat: data format of the variable (min and max are the theoretical extrema)</span>
<span class="sd">        bands: Name of the bands</span>
<span class="sd">        unit: of the data (for user information only)</span>
<span class="sd">        description: of the data (for user information only)</span>
<span class="sd">        palette: for rendering in png (TileServer). Must be created using create_palette.</span>
<span class="sd">        resampling_alg: when reprojection is needed (see entities.Resampling)</span>
<span class="sd">        exist_ok: (optional, see warning): if already exists, do not raise an error. !!! WARNING: it does not mean</span>
<span class="sd">            that the variable already stored in the geocube is exactly the same !!!</span>

<span class="sd">    Returns:</span>
<span class="sd">        the variable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_variable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.delete_grid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_grid</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Delete a grid by its name</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Delete a grid by its name &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_grid</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.delete_layout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_layout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Delete a layout from the Geocube</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Delete a layout from the Geocube &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_layout</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.delete_records" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_records</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">no_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Delete records iif no dataset are indexed to them.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>records</code></b>
                  (<code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="geocube.entities.Record" href="../../entities/record-reference/#geocube.entities.Record">Record</a>]]</code>)
              
              <div class="doc-md-description">
                <p>List of records to be deleted</p>
              </div>
            </li>
            <li>
              <b><code>no_fail</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>if true, do not fail if some records still have datasets that refer to them, and delete the others</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">no_fail</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete records iif no dataset are indexed to them.</span>

<span class="sd">    Args:</span>
<span class="sd">        records: List of records to be deleted</span>
<span class="sd">        no_fail: if true, do not fail if some records still have datasets that refer to them, and delete the others</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_records</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">no_fail</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.find_container_layouts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_container_layouts</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">records</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aoi</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find layouts of the containers covering an area or a list of records for a given instance</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_container_layouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">],</span>
                           <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">from_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">aoi</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find layouts of the containers covering an area or a list of records for a given instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_container_layouts</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">records</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="p">,</span> <span class="n">aoi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.get_cube" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_cube</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">undefined</span><span class="p">,</span> <span class="n">headers_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get a cube given a CubeParameters</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>params</code></b>
                  (<code><a class="autorefs autorefs-internal" title="geocube.entities.CubeParams" href="../../getcube/cubeparams-reference/#geocube.entities.CubeParams">CubeParams</a></code>)
              
              <div class="doc-md-description">
                <p>CubeParams (see entities.CubeParams)</p>
              </div>
            </li>
            <li>
              <b><code>resampling_alg</code></b>
                  (<code><span title="geocube.entities.Resampling">Resampling</span></code>, default:
                      <code><span title="geocube.entities.Resampling.undefined">undefined</span></code>
)
              
              <div class="doc-md-description">
                <p>if defined, overwrite the variable.Resampling used for reprojection.</p>
              </div>
            </li>
            <li>
              <b><code>headers_only</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>Only returns the header of each image (gives an overview of the query)</p>
              </div>
            </li>
            <li>
              <b><code>compression</code></b>
                  (<code><span title="int">int</span></code>, default:
                      <code>0</code>
)
              
              <div class="doc-md-description">
                <p>define a level of compression to speed up the transfer.
(0: no compression, 1 fastest to 9 best, -2: huffman-only)
The data is compressed by the server and decompressed by the Client.
Compression=0 or -2 is advised if the bandwidth is not limited</p>
              </div>
            </li>
            <li>
              <b><code>verbose</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>display information during the transfer (if None, use the default verbose mode)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="numpy.array">array</span>], <span title="typing.List">List</span>[<span title="geocube.entities.GroupedRecords">GroupedRecords</span>]]</code>
              
              <div class="doc-md-description">
                <p>list of images (np.ndarray) and the list of corresponding records
(several records can be returned for each image when they are grouped together,
by date or something else. See entities.Record.group_by)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeParams</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
             <span class="n">resampling_alg</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">undefined</span><span class="p">,</span>
             <span class="n">headers_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> \
        <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">GroupedRecords</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get a cube given a CubeParameters</span>

<span class="sd">    Args:</span>
<span class="sd">        params: CubeParams (see entities.CubeParams)</span>
<span class="sd">        resampling_alg: if defined, overwrite the variable.Resampling used for reprojection.</span>
<span class="sd">        headers_only: Only returns the header of each image (gives an overview of the query)</span>
<span class="sd">        compression: define a level of compression to speed up the transfer.</span>
<span class="sd">            (0: no compression, 1 fastest to 9 best, -2: huffman-only)</span>
<span class="sd">            The data is compressed by the server and decompressed by the Client.</span>
<span class="sd">            Compression=0 or -2 is advised if the bandwidth is not limited</span>
<span class="sd">        verbose: display information during the transfer (if None, use the default verbose mode)</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of images (np.ndarray) and the list of corresponding records</span>
<span class="sd">            (several records can be returned for each image when they are grouped together,</span>
<span class="sd">            by date or something else. See entities.Record.group_by)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cube_it</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="o">=</span><span class="n">resampling_alg</span><span class="p">,</span>
                             <span class="n">headers_only</span><span class="o">=</span><span class="n">headers_only</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
    <span class="n">images</span><span class="p">,</span> <span class="n">grouped_records</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">verbose</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GetCube returns </span><span class="si">{}</span><span class="s2"> images from </span><span class="si">{}</span><span class="s2"> datasets&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">cube</span><span class="o">.</span><span class="n">nb_datasets</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">cube</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="n">cubeiterator</span><span class="o">.</span><span class="n">NOT_FOUND_ERROR</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">min_date</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">min_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">max_date</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">max_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H:%M:%S&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image </span><span class="si">{}</span><span class="s2"> received (</span><span class="si">{}{}</span><span class="s2">kb) RecordTime:</span><span class="si">{}</span><span class="s2"> RecordName:</span><span class="si">{}</span><span class="s2"> Shape:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">cube</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span> <span class="k">if</span> <span class="n">headers_only</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">bytes</span> <span class="o">//</span> <span class="mi">1024</span><span class="p">,</span>
                <span class="n">min_date</span> <span class="k">if</span> <span class="n">min_date</span> <span class="o">==</span> <span class="n">max_date</span> <span class="k">else</span> <span class="n">min_date</span> <span class="o">+</span> <span class="s2">&quot; to &quot;</span> <span class="o">+</span> <span class="n">max_date</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">.</span><span class="n">grouped_records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">grouped_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">grouped_records</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">grouped_records</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.get_cube_it" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_cube_it</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="o">=</span><span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">undefined</span><span class="p">,</span> <span class="n">headers_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">FileFormatRaw</span><span class="p">,</span> <span class="n">file_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns a cube iterator over the requested images</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>params</code></b>
                  (<code><a class="autorefs autorefs-internal" title="geocube.entities.CubeParams" href="../../getcube/cubeparams-reference/#geocube.entities.CubeParams">CubeParams</a></code>)
              
              <div class="doc-md-description">
                <p>CubeParams (see entities.CubeParams)</p>
              </div>
            </li>
            <li>
              <b><code>resampling_alg</code></b>
                  (<code><span title="geocube.entities.Resampling">Resampling</span></code>, default:
                      <code><span title="geocube.entities.Resampling.undefined">undefined</span></code>
)
              
              <div class="doc-md-description">
                <p>if defined, overwrite the variable.Resampling used for reprojection.</p>
              </div>
            </li>
            <li>
              <b><code>headers_only</code></b>
              
              <div class="doc-md-description">
                <p>returns only the header of the dataset (use this option to control the output of get_cube)</p>
              </div>
            </li>
            <li>
              <b><code>compression</code></b>
              
              <div class="doc-md-description">
                <p>define a level of compression to speed up the transfer
(0: no compression, 1 fastest to 9 best, -2: huffman-only)
The data is compressed by the server and decompressed by the Client.
Compression=0 or -2 is advised if the bandwidth is not limited</p>
              </div>
            </li>
            <li>
              <b><code>file_format</code></b>
              
              <div class="doc-md-description">
                <p>(optional) currently supported geocube.FileFormatRaw &amp; geocube.FileFormatGTiff</p>
              </div>
            </li>
            <li>
              <b><code>file_pattern</code></b>
              
              <div class="doc-md-description">
                <p>(optional) iif file_format != Raw, pattern of the file name.
{#} will be replaced by the number of image, {date} and {id} by the value of the record</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="geocube.entities.CubeIterator">CubeIterator</span></code>
              
              <div class="doc-md-description">
                <p>an iterator yielding an image, its associated records, an error (or None) and the size of the image</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <blockquote>
<blockquote>
<blockquote>
<p>client = Client('127.0.0.1:8080', False)
cube_params = entities.CubeParams.from_records("+proj=utm +zone=31",
...     entities.geo_transform(366162, 4833123, 30), (512, 512),
...     client.variable(name="test/rgb").instance("master"), records=client.list_records('france'))
affine.Affine.translation(366162, 4833123)*affine.Affine.scale(30, -30))
cube_it = client.get_cube_it(cube_params)
from matplotlib import pyplot as plt
for image, <em>, </em>, err in cube_it:
...     if err != cubeiterator.NOT_FOUND_ERROR:
...         raise ValueError(err)
...     if not err:
...         plt.figure(cube_it.index+1)
...         plt.imshow(image)</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_cube_it</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeParams</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                <span class="n">resampling_alg</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">undefined</span><span class="p">,</span>
                <span class="n">headers_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">file_format</span><span class="o">=</span><span class="n">FileFormatRaw</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">CubeIterator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns a cube iterator over the requested images</span>

<span class="sd">    Args:</span>
<span class="sd">        params: CubeParams (see entities.CubeParams)</span>

<span class="sd">        resampling_alg: if defined, overwrite the variable.Resampling used for reprojection.</span>
<span class="sd">        headers_only : returns only the header of the dataset (use this option to control the output of get_cube)</span>
<span class="sd">        compression : define a level of compression to speed up the transfer</span>
<span class="sd">            (0: no compression, 1 fastest to 9 best, -2: huffman-only)</span>
<span class="sd">            The data is compressed by the server and decompressed by the Client.</span>
<span class="sd">            Compression=0 or -2 is advised if the bandwidth is not limited</span>
<span class="sd">        file_format : (optional) currently supported geocube.FileFormatRaw &amp; geocube.FileFormatGTiff</span>
<span class="sd">        file_pattern : (optional) iif file_format != Raw, pattern of the file name.</span>
<span class="sd">            {#} will be replaced by the number of image, {date} and {id} by the value of the record</span>

<span class="sd">    Returns:</span>
<span class="sd">        an iterator yielding an image, its associated records, an error (or None) and the size of the image</span>
<span class="sd">    &gt;&gt;&gt; client = Client(&#39;127.0.0.1:8080&#39;, False)</span>
<span class="sd">    &gt;&gt;&gt; cube_params = entities.CubeParams.from_records(&quot;+proj=utm +zone=31&quot;,</span>
<span class="sd">    ...     entities.geo_transform(366162, 4833123, 30), (512, 512),</span>
<span class="sd">    ...     client.variable(name=&quot;test/rgb&quot;).instance(&quot;master&quot;), records=client.list_records(&#39;france&#39;))</span>
<span class="sd">    affine.Affine.translation(366162, 4833123)*affine.Affine.scale(30, -30))</span>
<span class="sd">    &gt;&gt;&gt; cube_it = client.get_cube_it(cube_params)</span>
<span class="sd">    &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; for image, _, _, err in cube_it:</span>
<span class="sd">    ...     if err != cubeiterator.NOT_FOUND_ERROR:</span>
<span class="sd">    ...         raise ValueError(err)</span>
<span class="sd">    ...     if not err:</span>
<span class="sd">    ...         plt.figure(cube_it.index+1)</span>
<span class="sd">    ...         plt.imshow(image)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cube_it</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">resampling_alg</span><span class="o">=</span><span class="n">resampling_alg</span><span class="p">,</span> <span class="n">headers_only</span><span class="o">=</span><span class="n">headers_only</span><span class="p">,</span>
                             <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span> <span class="n">file_pattern</span><span class="o">=</span><span class="n">file_pattern</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.get_record" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_record</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Deprecated: use record() instead</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Deprecated: use record() instead &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.get_records" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_records</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get a list of records.</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_records</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.get_xyz_tile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_xyz_tile</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">records</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a PNG file covering the (X,Y,Z) web-mercator tile, using the palette of the variable.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>instance</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="geocube.entities.VariableInstance" href="../../entities/variable-reference/#geocube.entities.VariableInstance">VariableInstance</a>]</code>)
              
              <div class="doc-md-description">
                <p>instance of the variable</p>
              </div>
            </li>
            <li>
              <b><code>records</code></b>
                  (<code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="geocube.entities.Record" href="../../entities/record-reference/#geocube.entities.Record">Record</a>]]</code>)
              
              <div class="doc-md-description">
                <p>list of records</p>
              </div>
            </li>
            <li>
              <b><code>x</code></b>
                  (<code><span title="int">int</span></code>)
              
              <div class="doc-md-description">
                <p>coordinate of the web-mercator XYZ tile</p>
              </div>
            </li>
            <li>
              <b><code>y</code></b>
                  (<code><span title="int">int</span></code>)
              
              <div class="doc-md-description">
                <p>coordinate of the web-mercator XYZ tile</p>
              </div>
            </li>
            <li>
              <b><code>z</code></b>
                  (<code><span title="int">int</span></code>)
              
              <div class="doc-md-description">
                <p>coordinate of the web-mercator XYZ tile</p>
              </div>
            </li>
            <li>
              <b><code>file</code></b>
                  (<code><span title="str">str</span></code>)
              
              <div class="doc-md-description">
                <p>output PNG file</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_xyz_tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">],</span>
                 <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a PNG file covering the (X,Y,Z) web-mercator tile, using the palette of the variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        instance: instance of the variable</span>
<span class="sd">        records: list of records</span>
<span class="sd">        x: coordinate of the web-mercator XYZ tile</span>
<span class="sd">        y: coordinate of the web-mercator XYZ tile</span>
<span class="sd">        z: coordinate of the web-mercator XYZ tile</span>
<span class="sd">        file: output PNG file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xyz_tile</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">records</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">index</span><span class="p">(</span><span class="n">containers</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Index a new container.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>containers</code></b>
                  (<code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="geocube.entities.Container" href="../../entities/dataset-reference/#geocube.entities.Container">Container</a>]</code>)
              
              <div class="doc-md-description">
                <p>List of container to index.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">containers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Container</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Index a new container.</span>

<span class="sd">    Args:</span>
<span class="sd">        containers: List of container to index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span><span class="n">containers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.index_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">index_dataset</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exponent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">managed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Index the given "bands" of the dataset located at "uri", referenced by a record and an instance.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>uri</code></b>
                  (<code><span title="str">str</span></code>)
              
              <div class="doc-md-description">
                <p>of the file to index</p>
              </div>
            </li>
            <li>
              <b><code>record</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="geocube.entities.Record" href="../../entities/record-reference/#geocube.entities.Record">Record</a>, <span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>], <span title="datetime.datetime">datetime</span>]]</code>)
              
              <div class="doc-md-description">
                <p>id of the record describing the data-take or a tuple (name, metadata, datetime)
to create the record on the fly</p>
              </div>
            </li>
            <li>
              <b><code>instance</code></b>
                  (<code><a class="autorefs autorefs-internal" title="geocube.entities.VariableInstance" href="../../entities/variable-reference/#geocube.entities.VariableInstance">VariableInstance</a></code>)
              
              <div class="doc-md-description">
                <p>describing the data</p>
              </div>
            </li>
            <li>
              <b><code>dformat</code></b>
                  (<code><span title="geocube.entities.DataFormat">DataFormat</span></code>)
              
              <div class="doc-md-description">
                <p>describing the internal format (see entities.DataFormat.from_user())</p>
              </div>
            </li>
            <li>
              <b><code>bands</code></b>
                  (<code><span title="typing.List">List</span>[<span title="int">int</span>]</code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>subset of bands' file (start at 1) that maps to <code>variable.bands</code> (by default, all the bands)</p>
              </div>
            </li>
            <li>
              <b><code>min_out</code></b>
                  (<code><span title="float">float</span></code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>(optional, default: instance.dformat.min_value, instance.dformat.dtype) maps dformat.min_value</p>
              </div>
            </li>
            <li>
              <b><code>max_out</code></b>
                  (<code><span title="float">float</span></code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>(optional, default: instance.dformat.max_value, instance.dformat.dtype) maps dformat.max_value</p>
              </div>
            </li>
            <li>
              <b><code>exponent</code></b>
                  (<code><span title="float">float</span></code>, default:
                      <code>1</code>
)
              
              <div class="doc-md-description">
                <p>(optional, default: 1) non-linear scaling between dformat.min_max_value to min_max_out.</p>
              </div>
            </li>
            <li>
              <b><code>managed</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>if True, the geocube takes the ownership of the file, removing it if the dataset is removed</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">index_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">datetime</span><span class="p">]],</span>
                  <span class="n">instance</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">,</span> <span class="n">dformat</span><span class="p">:</span> <span class="n">entities</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">,</span> <span class="n">bands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">min_out</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_out</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">managed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Index the given &quot;bands&quot; of the dataset located at &quot;uri&quot;, referenced by a record and an instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        uri: of the file to index</span>
<span class="sd">        record: id of the record describing the data-take or a tuple (name, metadata, datetime)</span>
<span class="sd">            to create the record on the fly</span>
<span class="sd">        instance: describing the data</span>
<span class="sd">        dformat: describing the internal format (see entities.DataFormat.from_user())</span>
<span class="sd">        bands: subset of bands&#39; file (start at 1) that maps to `variable.bands` (by default, all the bands)</span>
<span class="sd">        min_out: (optional, default: instance.dformat.min_value, instance.dformat.dtype) maps dformat.min_value</span>
<span class="sd">        max_out: (optional, default: instance.dformat.max_value, instance.dformat.dtype) maps dformat.max_value</span>
<span class="sd">        exponent: (optional, default: 1) non-linear scaling between dformat.min_max_value to min_max_out.</span>
<span class="sd">        managed: if True, the geocube takes the ownership of the file, removing it if the dataset is removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_dataset</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">min_out</span><span class="p">,</span> <span class="n">max_out</span><span class="p">,</span> <span class="n">exponent</span><span class="p">,</span> <span class="n">managed</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.layout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">layout</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get layout by name</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get layout by name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.list_grids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_grids</span><span class="p">(</span><span class="n">name_like</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>List grids by name
name_like: pattern of the name. * and ? are supported to match all or any character.</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_like</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Grid</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List grids by name</span>
<span class="sd">    name_like: pattern of the name. * and ? are supported to match all or any character.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_grids</span><span class="p">(</span><span class="n">name_like</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.list_layouts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_layouts</span><span class="p">(</span><span class="n">name_like</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>List available layouts by name
name_like: pattern of the name. * and ? are supported to match all or any character.</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_layouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_like</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List available layouts by name</span>
<span class="sd">    name_like: pattern of the name. * and ? are supported to match all or any character.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_layouts</span><span class="p">(</span><span class="n">name_like</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.list_records" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_records</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aoi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">with_aoi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>List records given filters</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>name</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;&#39;</code>
)
              
              <div class="doc-md-description">
                <p>pattern of the name. * and ? are supported to match all or any character.
(?i) can be added at the end to be insensitive to case</p>
              </div>
            </li>
            <li>
              <b><code>tags</code></b>
                  (<code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>list of mandatory tags. Support the same pattern as name.</p>
              </div>
            </li>
            <li>
              <b><code>from_time</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>filter by date</p>
              </div>
            </li>
            <li>
              <b><code>to_time</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>filter by date</p>
              </div>
            </li>
            <li>
              <b><code>aoi</code></b>
                  (<code><span title="shapely.geometry.MultiPolygon">MultiPolygon</span></code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>records that intersect the AOI in geographic coordinates</p>
              </div>
            </li>
            <li>
              <b><code>limit</code></b>
                  (<code><span title="int">int</span></code>, default:
                      <code>10000</code>
)
              
              <div class="doc-md-description">
                <p>the number of records returned (0 to return all records)</p>
              </div>
            </li>
            <li>
              <b><code>page</code></b>
                  (<code><span title="int">int</span></code>, default:
                      <code>0</code>
)
              
              <div class="doc-md-description">
                <p>start at 0</p>
              </div>
            </li>
            <li>
              <b><code>with_aoi</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>also returns the AOI of the record. Otherwise, only the ID of the aoi is returned.
load_aoi(record) can be called to retrieve the AOI later.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="geocube.entities.Record" href="../../entities/record-reference/#geocube.entities.Record">Record</a>]</code>
              
              <div class="doc-md-description">
                <p>a list of records</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">from_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">to_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">aoi</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_aoi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List records given filters</span>

<span class="sd">    Args:</span>
<span class="sd">        name: pattern of the name. * and ? are supported to match all or any character.</span>
<span class="sd">            (?i) can be added at the end to be insensitive to case</span>
<span class="sd">        tags: list of mandatory tags. Support the same pattern as name.</span>
<span class="sd">        from_time: filter by date</span>
<span class="sd">        to_time: filter by date</span>
<span class="sd">        aoi: records that intersect the AOI in geographic coordinates</span>
<span class="sd">        limit: the number of records returned (0 to return all records)</span>
<span class="sd">        page: start at 0</span>
<span class="sd">        with_aoi: also returns the AOI of the record. Otherwise, only the ID of the aoi is returned.</span>
<span class="sd">            load_aoi(record) can be called to retrieve the AOI later.</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of records</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_records</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">from_time</span><span class="p">,</span> <span class="n">to_time</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">with_aoi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.list_variables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_variables</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>List all the variables given a pattern</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>name</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;&#39;</code>
)
              
              <div class="doc-md-description">
                <p>pattern of the name. * and ? are supported to match all or any character.
(?i) can be added at the end to be insensitive to case</p>
              </div>
            </li>
            <li>
              <b><code>limit</code></b>
                  (<code><span title="int">int</span></code>, default:
                      <code>0</code>
)
              
              <div class="doc-md-description">
                <p>limit the number of variables returned</p>
              </div>
            </li>
            <li>
              <b><code>page</code></b>
                  (<code><span title="int">int</span></code>, default:
                      <code>0</code>
)
              
              <div class="doc-md-description">
                <p>number of the page (starting at 0).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="geocube.entities.Variable" href="../../entities/variable-reference/#geocube.entities.Variable">Variable</a>]</code>
              
              <div class="doc-md-description">
                <p>a list of variable</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List all the variables given a pattern</span>

<span class="sd">    Args:</span>
<span class="sd">        name: pattern of the name. * and ? are supported to match all or any character.</span>
<span class="sd">            (?i) can be added at the end to be insensitive to case</span>
<span class="sd">        limit: limit the number of variables returned</span>
<span class="sd">        page: number of the page (starting at 0).</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of variable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_variables</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.load_aoi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_aoi</span><span class="p">(</span><span class="n">aoi_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Load the geometry of the AOI of the given record</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>aoi_id</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="geocube.entities.Record" href="../../entities/record-reference/#geocube.entities.Record">Record</a>]</code>)
              
              <div class="doc-md-description">
                <p>uuid of the AOI or the record. If the record is provided, its geometry will be updated</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="shapely.geometry.MultiPolygon">MultiPolygon</span></code>
              
              <div class="doc-md-description">
                <p>the geometry of the AOI</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the geometry of the AOI of the given record</span>

<span class="sd">    Args:</span>
<span class="sd">        aoi_id: uuid of the AOI or the record. If the record is provided, its geometry will be updated</span>

<span class="sd">    Returns:</span>
<span class="sd">        the geometry of the AOI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_aoi</span><span class="p">(</span><span class="n">aoi_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.record" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">record</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get a record by id</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get a record by id &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_records</span><span class="p">([</span><span class="n">_id</span><span class="p">])</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">GeocubeError</span><span class="p">(</span><span class="s2">&quot;get_record&quot;</span><span class="p">,</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;record with id &quot;</span> <span class="o">+</span> <span class="n">_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.remove_records_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_records_tags</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">tag_keys</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Remove tags keys from a list of records</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>records</code></b>
                  (<code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="geocube.entities.Record" href="../../entities/record-reference/#geocube.entities.Record">Record</a>]]</code>)
              
              <div class="doc-md-description">
                <p>List of records to be updated</p>
              </div>
            </li>
            <li>
              <b><code>tag_keys</code></b>
                  (<code><span title="typing.List">List</span>[<span title="str">str</span>]</code>)
              
              <div class="doc-md-description">
                <p>List of keys to be deleted</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="int">int</span></code>
              
              <div class="doc-md-description">
                <p>the number of updated records</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_records_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">Record</span><span class="p">]],</span> <span class="n">tag_keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Remove tags keys from a list of records</span>

<span class="sd">    Args:</span>
<span class="sd">        records: List of records to be updated</span>
<span class="sd">        tag_keys: List of keys to be deleted</span>

<span class="sd">    Returns:</span>
<span class="sd">        the number of updated records</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_records_tags</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">tag_keys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.tile_aoi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tile_aoi</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">layout_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Tile an AOI</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>aoi</code></b>
                  (<code><span title="typing.Union">Union</span>[<span title="shapely.geometry.MultiPolygon">MultiPolygon</span>, <span title="shapely.geometry.Polygon">Polygon</span>]</code>)
              
              <div class="doc-md-description">
                <p>AOI to be tiled in <strong>geographic coordinates</strong></p>
              </div>
            </li>
            <li>
              <b><code>crs</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>CRS of the tile (not the AOI)</p>
              </div>
            </li>
            <li>
              <b><code>resolution</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>resolution of the tile</p>
              </div>
            </li>
            <li>
              <b><code>shape</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>]]</code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>shape of each tile</p>
              </div>
            </li>
            <li>
              <b><code>layout_name</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>use a defined layout.</p>
              </div>
            </li>
            <li>
              <b><code>layout</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="geocube.entities.Layout" href="../../entities/layout-reference/#geocube.entities.Layout">Layout</a>]</code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>use a customer defined layout</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="geocube.entities.Tile" href="../../getcube/tile-reference/#geocube.entities.Tile">Tile</a>]</code>
              
              <div class="doc-md-description">
                <p>a list of Tiles covering the AOI in the given CRS at the given resolution</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tile_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">],</span>
             <span class="n">layout_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">layout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Layout</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">resolution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Tile</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tile an AOI</span>

<span class="sd">    Args:</span>
<span class="sd">        aoi: AOI to be tiled in **geographic coordinates**</span>
<span class="sd">        crs: CRS of the tile (not the AOI)</span>
<span class="sd">        resolution: resolution of the tile</span>
<span class="sd">        shape: shape of each tile</span>
<span class="sd">        layout_name: use a defined layout.</span>
<span class="sd">        layout: use a customer defined layout</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of Tiles covering the AOI in the given CRS at the given resolution</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_aoi</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">layout_name</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.variable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">variable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">id_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instance_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Fetch a variable given an id, a name or an instance id (mutually exclusive)</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>name</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                
              </div>
            </li>
            <li>
              <b><code>id_</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>internal id of the variable (uuid4)</p>
              </div>
            </li>
            <li>
              <b><code>instance_id</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>None</code>
)
              
              <div class="doc-md-description">
                <p>internal id of one instance of the variable (uuid4)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="geocube.entities.Variable" href="../../entities/variable-reference/#geocube.entities.Variable">Variable</a>, <a class="autorefs autorefs-internal" title="geocube.entities.VariableInstance" href="../../entities/variable-reference/#geocube.entities.VariableInstance">VariableInstance</a>]</code>
              
              <div class="doc-md-description">
                <p>either a Variable (first two cases) or a VariableInstance (specialization of the variable)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">id_</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> \
        <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">Variable</span><span class="p">,</span> <span class="n">entities</span><span class="o">.</span><span class="n">VariableInstance</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch a variable given an id, a name or an instance id (mutually exclusive)</span>

<span class="sd">    Args:</span>
<span class="sd">        name:</span>
<span class="sd">        id_: internal id of the variable (uuid4)</span>
<span class="sd">        instance_id: internal id of one instance of the variable (uuid4)</span>

<span class="sd">    Returns:</span>
<span class="sd">        either a Variable (first two cases) or a VariableInstance (specialization of the variable)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geocube.Client.version" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">version</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns the version of the Geocube Server</p>


            <details class="quote">
              <summary>Source code in <code>geocube/client.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns the version of the Geocube Server &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../tutorials/" class="btn btn-neutral float-left" title="Tutorials"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../consolidater-reference/" class="btn btn-neutral float-right" title="Consolidater">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../tutorials/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../consolidater-reference/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
